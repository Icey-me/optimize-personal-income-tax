<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­å·è–ªèµ„å¹´ç»ˆå¥–ä¸ªç¨æœ€ä¼˜è§„åˆ’è®¡ç®—å™¨ï¼ˆå…¨ç»´åº¦ï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        body {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .input-section {
            max-width: 700px;
            margin: 0 auto 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
            }
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        select {
            appearance: none;
            background: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2334495e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 12px center;
            background-size: 16px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        button {
            width: 100%;
            max-width: 700px;
            padding: 14px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            margin: 0 auto;
            display: block;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #1d4ed8;
        }
        
        .result {
            display: none;
            margin-top: 20px;
        }
        
        .result h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
            text-align: center;
        }
        
        /* å·¦å³ä¸¤åˆ—å¯¹æ¯”è¡¨æ ¼æ ·å¼ */
        .compare-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
        }
        
        .compare-table th, .compare-table td {
            padding: 12px 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
            font-size: 14px;
        }
        
        .compare-table th {
            background-color: #f1f5f9;
            color: #2c3e50;
            font-weight: 600;
            font-size: 15px;
        }
        
        /* è§„åˆ’å‰/ååˆ—å¤´æ ·å¼ */
        .col-before {
            background-color: #fef2f2;
            color: #dc2626;
        }
        
        .col-after {
            background-color: #f0fdf4;
            color: #16a34a;
        }
        
        /* å…³é”®æ•°æ®é«˜äº® */
        .highlight {
            font-weight: 700;
            font-size: 15px;
        }
        
        .save-tax {
            color: #16a34a;
            font-weight: 700;
        }
        
        .reduce {
            color: #dc2626;
            font-weight: 700;
        }
        
        .note {
            margin-top: 20px;
            padding: 18px;
            background-color: #e8f4fd;
            border-left: 4px solid #3b82f6;
            color: #2c3e50;
            font-size: 14px;
            line-height: 1.6;
            border-radius: 0 6px 6px 0;
        }
        
        .deduct-note {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ­å·è–ªèµ„å¹´ç»ˆå¥–ä¸ªç¨æœ€ä¼˜è§„åˆ’è®¡ç®—å™¨</h1>
        
        <!-- è¾“å…¥åŒºåŸŸï¼šå«äº”é™©ä¸€é‡‘è–ªèµ„ + æ­å·ç¤¾ä¿å…¬ç§¯é‡‘ + ä¸“é¡¹é™„åŠ æ‰£é™¤ + å¹´ç»ˆå¥–å‘æ”¾æœˆä»½é€‰æ‹© -->
        <div class="input-section">
            <div class="input-group full-width">
                <label for="monthlySalaryGross">æœˆåº¦è–ªèµ„ï¼ˆå…ƒï¼Œå«äº”é™©ä¸€é‡‘ï¼‰ï¼š</label>
                <input type="number" id="monthlySalaryGross" placeholder="ä¾‹ï¼š20000ï¼Œä»…å¡«æ•°å­—" min="0" step="1" required>
            </div>
            
            <div class="input-group">
                <label for="yearBonus">å¹´ç»ˆå¥–æ€»é¢ï¼ˆå…ƒï¼‰ï¼š</label>
                <input type="number" id="yearBonus" placeholder="ä¾‹ï¼š100000ï¼Œä»…å¡«æ•°å­—" min="0" step="1" required>
            </div>
            
            <div class="input-group">
                <label for="bonusMonth">å¹´ç»ˆå¥–å‘æ”¾æœˆä»½ï¼š</label>
                <select id="bonusMonth" required>
                    <option value="1">1æœˆ</option>
                    <option value="2" selected>2æœˆ</option>
                    <option value="3">3æœˆ</option>
                    <option value="4">4æœˆ</option>
                    <option value="5">5æœˆ</option>
                    <option value="6">6æœˆ</option>
                    <option value="7">7æœˆ</option>
                    <option value="8">8æœˆ</option>
                    <option value="9">9æœˆ</option>
                    <option value="10">10æœˆ</option>
                    <option value="11">11æœˆ</option>
                    <option value="12">12æœˆ</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="specialDeduction">æ¯æœˆä¸“é¡¹é™„åŠ æ‰£é™¤ï¼ˆå…ƒï¼‰ï¼š</label>
                <input type="number" id="specialDeduction" placeholder="ä¾‹ï¼š2000ï¼ˆæˆ¿è´·1000+å­å¥³1000ï¼‰" min="0" step="1" value="0">
                <div class="deduct-note">ä¸“é¡¹æ‰£é™¤åŒ…å«ï¼šå­å¥³æ•™è‚²/ç»§ç»­æ•™è‚²/å¤§ç—…åŒ»ç–—/ä½æˆ¿è´·æ¬¾åˆ©æ¯/ä½æˆ¿ç§Ÿé‡‘/èµ¡å…»è€äºº/å©´å¹¼å„¿ç…§æŠ¤</div>
            </div>
            
            <div class="input-group">
                <label for="housingFundRatio">å…¬ç§¯é‡‘ç¼´çº³æ¯”ä¾‹ï¼ˆ%ï¼‰ï¼š</label>
                <input type="number" id="housingFundRatio" placeholder="é»˜è®¤12%" min="5" max="12" step="0.5" value="12">
                <div class="deduct-note">æ­å·å…¬ç§¯é‡‘æ¯”ä¾‹ï¼š5%-12%ï¼Œé»˜è®¤æŒ‰12%è®¡ç®—</div>
            </div>
        </div>
        
        <button id="calculateBtn">è®¡ç®—æœ€ä¼˜ä¸ªç¨æ–¹æ¡ˆ</button>
        
        <!-- ç»“æœå¯¹æ¯”åŒºåŸŸ -->
        <div class="result" id="result">
            <h2 id="resultTitle">è§„åˆ’å‰ VS è§„åˆ’å å…¨ç»´åº¦ç¨åŠ¡å¯¹æ¯”ï¼ˆå¹´ç»ˆå¥–2æœˆå‘æ”¾ï¼‰</h2>
            <table class="compare-table">
                <thead>
                    <tr>
                        <th rowspan="2" style="min-width: 220px;">å¯¹æ¯”é¡¹ç›®</th>
                        <th class="col-before">è§„åˆ’å‰<br>ï¼ˆå¹´ç»ˆå¥–å…¨éƒ¨å•ç‹¬è®¡ç¨ï¼‰</th>
                        <th class="col-after">è§„åˆ’å<br>ï¼ˆæœ€ä¼˜æ‹†åˆ†/æœ€ä½ä¸ªç¨ï¼‰</th>
                        <th rowspan="2">å·®å¼‚ï¼ˆå…ƒï¼‰<br>è§„åˆ’å-è§„åˆ’å‰</th>
                    </tr>
                    <tr>
                        <th>é‡‘é¢/ä¸ªç¨ï¼ˆå…ƒï¼‰</th>
                        <th>é‡‘é¢/ä¸ªç¨ï¼ˆå…ƒï¼‰</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>æœˆåº¦è–ªèµ„ï¼ˆå«äº”é™©ä¸€é‡‘ï¼‰</td>
                        <td id="before-salary-gross" class="highlight">-</td>
                        <td id="after-salary-gross" class="highlight">-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>æœˆåº¦äº”é™©ä¸€é‡‘æ‰£é™¤ï¼ˆä¸ªäººéƒ¨åˆ†ï¼‰</td>
                        <td id="before-five-insurance" class="highlight">-</td>
                        <td id="after-five-insurance" class="highlight">-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>æœˆåº¦è–ªèµ„ï¼ˆæ‰£é™¤äº”é™©ä¸€é‡‘åï¼‰</td>
                        <td id="before-salary-net" class="highlight">-</td>
                        <td id="after-salary-net" class="highlight">-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>å…¨å¹´ç»¼åˆæ”¶å…¥ï¼ˆè–ªèµ„+å¹´ç»ˆå¥–ï¼‰</td>
                        <td id="before-total-income" class="highlight">-</td>
                        <td id="after-total-income" class="highlight">-</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>å¹´ç»ˆå¥–å•ç‹¬è®¡ç¨é‡‘é¢</td>
                        <td id="before-bonus" class="highlight">-</td>
                        <td id="after-bonus" class="highlight">-</td>
                        <td id="diff-bonus">-</td>
                    </tr>
                    <tr>
                        <td>å¹¶å…¥å‘æ”¾æœˆè–ªèµ„çš„å¥–é‡‘é‡‘é¢</td>
                        <td id="before-merge">-</td>
                        <td id="after-merge" class="highlight">-</td>
                        <td id="diff-merge">-</td>
                    </tr>
                    <tr>
                        <td>å‘æ”¾æœˆè–ªèµ„æ€»é¢ï¼ˆå«å¹¶å…¥å¥–é‡‘ï¼‰</td>
                        <td id="before-bonus-month-income" class="highlight">-</td>
                        <td id="after-bonus-month-income" class="highlight">-</td>
                        <td id="diff-bonus-month-income">-</td>
                    </tr>
                    <tr>
                        <td>å‘æ”¾æœˆè–ªèµ„ä¸ªç¨ï¼ˆå«å¹¶å…¥å¥–é‡‘ï¼‰</td>
                        <td id="before-bonus-month-tax" class="highlight">-</td>
                        <td id="after-bonus-month-tax" class="highlight">-</td>
                        <td id="diff-bonus-month-tax">-</td>
                    </tr>
                    <tr>
                        <td>å‘æ”¾æœˆè–ªèµ„ç¨åæ”¶å…¥</td>
                        <td id="before-bonus-month-after-tax" class="highlight">-</td>
                        <td id="after-bonus-month-after-tax" class="highlight">-</td>
                        <td id="diff-bonus-month-after-tax" class="save-tax">-</td>
                    </tr>
                    <tr>
                        <td>å¹´ç»ˆå¥–ç¨åé‡‘é¢</td>
                        <td id="before-bonus-after-tax" class="highlight">-</td>
                        <td id="after-bonus-after-tax" class="highlight">-</td>
                        <td id="diff-bonus-after-tax">-</td>
                    </tr>
                    <tr>
                        <td><strong>å‘æ”¾æœˆåˆ°æ‰‹æ€»æ”¶å…¥ï¼ˆè–ªèµ„ç¨å+å¹´ç»ˆå¥–ç¨åï¼‰</strong></td>
                        <td id="before-feb-total-after-tax" class="highlight">-</td>
                        <td id="after-feb-total-after-tax" class="highlight">-</td>
                        <td id="diff-feb-total-after-tax" class="save-tax">-</td>
                    </tr>
                    <tr>
                        <td>å…¨å¹´è–ªèµ„ç»¼åˆæ‰€å¾—ä¸ªç¨ï¼ˆå«å¹¶å…¥å¥–é‡‘ï¼‰</td>
                        <td id="before-salary-tax" class="highlight">-</td>
                        <td id="after-salary-tax" class="highlight">-</td>
                        <td id="diff-salary-tax">-</td>
                    </tr>
                    <tr>
                        <td>å¹´ç»ˆå¥–å•ç‹¬è®¡ç¨ä¸ªç¨</td>
                        <td id="before-bonus-tax" class="highlight">-</td>
                        <td id="after-bonus-tax" class="highlight">-</td>
                        <td id="diff-bonus-tax">-</td>
                    </tr>
                    <tr style="background-color: #f8fafc;">
                        <td><strong>å…¨å¹´ä¸ªç¨æ€»é¢ï¼ˆè–ªèµ„+å¹´ç»ˆå¥–ï¼‰</strong></td>
                        <td id="before-total-tax" class="highlight">-</td>
                        <td id="after-total-tax" class="highlight">-</td>
                        <td id="save-tax" class="save-tax">-</td>
                    </tr>
                    <tr style="background-color: #f8fafc;">
                        <td><strong>å…¨å¹´ç¨åæ€»æ”¶å…¥ï¼ˆæ”¶å…¥-æ€»ä¸ªç¨ï¼‰</strong></td>
                        <td id="before-after-tax-income" class="highlight">-</td>
                        <td id="after-after-tax-income" class="highlight">-</td>
                        <td id="diff-after-tax-income" class="save-tax">-</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="note">
                <strong>ğŸ“Œ æ­å·æœ¬åœ°è®¡ç®—è§„åˆ™è¯´æ˜</strong><br>
                1. äº”é™©ä¸€é‡‘æ‰£é™¤ï¼ˆ2026å¹´æ­å·æ ‡å‡†ï¼‰ï¼š<br>
                &nbsp;&nbsp;â€¢ å…»è€ä¿é™©ï¼š8% | åŒ»ç–—ä¿é™©ï¼š2%+3å…ƒ | å¤±ä¸šä¿é™©ï¼š0.5% | å…¬ç§¯é‡‘ï¼šæŒ‰è¾“å…¥æ¯”ä¾‹ï¼ˆ5%-12%ï¼‰<br>
                &nbsp;&nbsp;â€¢ ç¤¾ä¿åŸºæ•°ä¸Šä¸‹é™ï¼šä¸‹é™4491å…ƒï¼Œä¸Šé™24311å…ƒï¼›å…¬ç§¯é‡‘åŸºæ•°ä¸Šä¸‹é™ï¼šä¸‹é™2280å…ƒï¼Œä¸Šé™41200å…ƒ<br>
                2. ä¸ªç¨èµ·å¾ç‚¹ï¼šæ¯æœˆ5000å…ƒï¼Œä¸“é¡¹é™„åŠ æ‰£é™¤æŒ‰æœˆç´¯åŠ ï¼Œé‡‡ç”¨ç´¯è®¡é¢„æ‰£é¢„ç¼´æ³•è®¡ç®—æœˆåº¦ä¸ªç¨ï¼›<br>
                3. å¹´ç»ˆå¥–å‘æ”¾æœˆä»½ï¼šæŒ‰é€‰æ‹©æœˆä»½è®¡ç®—ï¼Œå¹¶å…¥å¥–é‡‘ä»…è®¡å…¥è¯¥æœˆè–ªèµ„è®¡ç¨ï¼Œå¹´ç»ˆå¥–å•ç‹¬è®¡ç¨éƒ¨åˆ†ç¨åå‘æ”¾ï¼›<br>
                4. å‘æ”¾æœˆåˆ°æ‰‹æ€»æ”¶å…¥=å‘æ”¾æœˆè–ªèµ„ç¨åæ”¶å…¥+å¹´ç»ˆå¥–ç¨åé‡‘é¢ï¼ˆå•ç‹¬è®¡ç¨éƒ¨åˆ†ï¼‰ï¼›<br>
                5. æœ€ä¼˜æ–¹æ¡ˆï¼šéå†ä¸ªç¨ä¸´ç•Œç‚¹ï¼ˆ3.6ä¸‡/14.4ä¸‡/30ä¸‡ç­‰ï¼‰ï¼Œæ‰¾åˆ°æ‹†åˆ†åä¸ªç¨æ€»é¢æœ€ä½çš„åˆæ³•ç»„åˆï¼›<br>
                6. æœ¬ç»“æœä¸ºç¨åŠ¡ç­¹åˆ’å‚è€ƒï¼Œå®é™…ä¸ªç¨/ç¤¾ä¿ç¼´çº³ä»¥æ­å·ç¨åŠ¡/ç¤¾ä¿éƒ¨é—¨æ ¸ç®—ã€ä¼ä¸šç”³æŠ¥ä¸ºå‡†ã€‚
            </div>
        </div>
    </div>

    <script>
        // 2026å¹´æ­å·ç¤¾ä¿åŸºæ•°ä¸Šä¸‹é™ï¼ˆå…ƒï¼‰
        const HANGZHOU_SOCIAL_BASE = {
            min: 4491,    // ç¤¾ä¿åŸºæ•°ä¸‹é™
            max: 24311,   // ç¤¾ä¿åŸºæ•°ä¸Šé™
            fundMin: 2280,// å…¬ç§¯é‡‘åŸºæ•°ä¸‹é™
            fundMax: 41200// å…¬ç§¯é‡‘åŸºæ•°ä¸Šé™
        };

        // æ­å·ç¤¾ä¿ä¸ªäººç¼´çº³æ¯”ä¾‹
        const SOCIAL_RATIOS = {
            pension: 0.08,    // å…»è€ä¿é™©8%
            medical: 0.02,    // åŒ»ç–—ä¿é™©2%
            medicalFixed: 3,  // åŒ»ç–—å›ºå®šæ‰£é™¤3å…ƒ
            unemployment: 0.005 // å¤±ä¸šä¿é™©0.5%
        };

        // ç»¼åˆæ‰€å¾—ç¨ç‡è¡¨ï¼ˆæœˆåº¦ç´¯è®¡é¢„æ‰£ï¼Œå¹´åº¦ä¸´ç•Œç‚¹ï¼‰
        const monthlyTaxRates = [
            { threshold: 0, rate: 0.03, quickDeduction: 0 },
            { threshold: 36000, rate: 0.1, quickDeduction: 2520 },
            { threshold: 144000, rate: 0.2, quickDeduction: 16920 },
            { threshold: 300000, rate: 0.25, quickDeduction: 31920 },
            { threshold: 420000, rate: 0.3, quickDeduction: 52920 },
            { threshold: 660000, rate: 0.35, quickDeduction: 85920 },
            { threshold: 960000, rate: 0.45, quickDeduction: 181920 }
        ];

        // å¹´ç»ˆå¥–å•ç‹¬è®¡ç¨ç¨ç‡è¡¨ï¼ˆæœˆåº¦ï¼‰
        const bonusTaxRates = [
            { threshold: 0, rate: 0.03, quickDeduction: 0 },
            { threshold: 3000, rate: 0.1, quickDeduction: 210 },
            { threshold: 12000, rate: 0.2, quickDeduction: 1410 },
            { threshold: 25000, rate: 0.25, quickDeduction: 2660 },
            { threshold: 35000, rate: 0.3, quickDeduction: 4410 },
            { threshold: 55000, rate: 0.35, quickDeduction: 7160 },
            { threshold: 80000, rate: 0.45, quickDeduction: 15160 }
        ];

        // æ ¼å¼åŒ–æ•°å­—ï¼šä¿ç•™2ä½å°æ•°+åƒåˆ†ä½ï¼Œè´Ÿæ•°è¡¥0
        const formatNum = (num) => {
            const n = Math.max(0, parseFloat(num) || 0);
            return n.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        // è®¡ç®—å·®å¼‚å€¼å¹¶æ·»åŠ æ ·å¼ï¼ˆæ­£æ•°ç»¿è‰²ï¼Œè´Ÿæ•°çº¢è‰²ï¼‰
        const formatDiff = (num) => {
            const n = parseFloat(num) || 0;
            if (n > 0) return `<span class="save-tax">+${formatNum(n)}</span>`;
            if (n < 0) return `<span class="reduce">${formatNum(n)}</span>`;
            return formatNum(n);
        };

        // è®¡ç®—æ­å·äº”é™©ä¸€é‡‘ä¸ªäººæ‰£é™¤é¢ï¼ˆæ ¸å¿ƒï¼šæŒ‰åŸºæ•°ä¸Šä¸‹é™+æ¯”ä¾‹ï¼‰
        function calculateFiveInsuranceFund(salaryGross, fundRatio) {
            // 1. è®¡ç®—ç¤¾ä¿åŸºæ•°ï¼ˆè–ªèµ„åœ¨ä¸Šä¸‹é™ä¹‹é—´å–å®é™…å€¼ï¼Œå¦åˆ™å–ä¸Šä¸‹é™ï¼‰
            const socialBase = Math.max(HANGZHOU_SOCIAL_BASE.min, Math.min(HANGZHOU_SOCIAL_BASE.max, salaryGross));
            // 2. è®¡ç®—å…¬ç§¯é‡‘åŸºæ•°
            const fundBase = Math.max(HANGZHOU_SOCIAL_BASE.fundMin, Math.min(HANGZHOU_SOCIAL_BASE.fundMax, salaryGross));
            // 3. è®¡ç®—å„é™©ç§æ‰£é™¤é¢
            const pension = socialBase * SOCIAL_RATIOS.pension;
            const medical = socialBase * SOCIAL_RATIOS.medical + SOCIAL_RATIOS.medicalFixed;
            const unemployment = socialBase * SOCIAL_RATIOS.unemployment;
            const housingFund = fundBase * (fundRatio / 100);
            // 4. åˆè®¡æ‰£é™¤é¢
            const totalDeduct = pension + medical + unemployment + housingFund;
            // 5. æ‰£é™¤åçš„è–ªèµ„
            const salaryNet = salaryGross - totalDeduct;

            return {
                pension,
                medical,
                unemployment,
                housingFund,
                totalDeduct,
                salaryNet
            };
        }

        // è®¡ç®—ç´¯è®¡é¢„æ‰£ä¸ªç¨+è¿”å›æ˜ç»†ï¼ˆå«æ­å·ç¤¾ä¿+ä¸“é¡¹æ‰£é™¤+è‡ªå®šä¹‰å‘æ”¾æœˆä»½ï¼‰
        function calculateSalaryTaxDetail(salaryNet, specialDeduct, mergeToSalary, bonusMonth = 2) {
            let totalTax = 0; // å…¨å¹´è–ªèµ„ä¸ªç¨æ€»é¢
            let cumulativeIncome = 0; // ç´¯è®¡æ”¶å…¥ï¼ˆæ‰£é™¤äº”é™©ä¸€é‡‘åï¼‰
            const baseDed = 5000; // æ¯æœˆèµ·å¾ç‚¹
            let bonusMonthTax = 0; // å‘æ”¾æœˆè–ªèµ„ä¸ªç¨
            let bonusMonthTotalIncome = salaryNet; // å‘æ”¾æœˆè–ªèµ„æ€»é¢ï¼ˆå«å¹¶å…¥å¥–é‡‘ï¼‰

            for (let month = 1; month <= 12; month++) {
                // å½“æœˆæ”¶å…¥ï¼šå‘æ”¾æœˆå åŠ å¹¶å…¥å¥–é‡‘ï¼Œå…¶ä»–æœˆä»½ä¸ºæ‰£é™¤äº”é™©ä¸€é‡‘åçš„è–ªèµ„
                if (month === bonusMonth) {
                    bonusMonthTotalIncome = salaryNet + mergeToSalary;
                }
                const curIncome = month === bonusMonth ? bonusMonthTotalIncome : salaryNet;
                cumulativeIncome += curIncome;
                
                // ç´¯è®¡æ‰£é™¤ï¼šèµ·å¾ç‚¹+ä¸“é¡¹é™„åŠ æ‰£é™¤ï¼ˆæ¯æœˆç´¯åŠ ï¼‰
                const cumulativeDeduct = (baseDed + specialDeduct) * month;
                // ç´¯è®¡åº”çº³ç¨æ‰€å¾—é¢
                const cumulativeTaxable = Math.max(0, cumulativeIncome - cumulativeDeduct);
                
                // è®¡ç®—ç´¯è®¡åº”ç¼´ä¸ªç¨
                let cumulativeTax = 0;
                if (cumulativeTaxable > 0) {
                    for (let i = monthlyTaxRates.length - 1; i >= 0; i--) {
                        const b = monthlyTaxRates[i];
                        if (cumulativeTaxable > b.threshold) {
                            cumulativeTax = cumulativeTaxable * b.rate - b.quickDeduction;
                            break;
                        }
                    }
                }
                
                // å½“æœˆä¸ªç¨ = ç´¯è®¡ä¸ªç¨ - ç´¯è®¡å·²ç¼´ä¸ªç¨
                const monthTax = cumulativeTax - totalTax;
                // è®°å½•å‘æ”¾æœˆå½“æœˆä¸ªç¨
                if (month === bonusMonth) bonusMonthTax = monthTax;
                totalTax += monthTax;
            }

            // è®¡ç®—å‘æ”¾æœˆè–ªèµ„ç¨åæ”¶å…¥ = å‘æ”¾æœˆè–ªèµ„æ€»é¢ - å‘æ”¾æœˆè–ªèµ„ä¸ªç¨
            const bonusMonthAfterTax = bonusMonthTotalIncome - bonusMonthTax;

            return {
                annualSalaryTax: totalTax, // å…¨å¹´è–ªèµ„ä¸ªç¨
                bonusMonthTax: bonusMonthTax, // å‘æ”¾æœˆè–ªèµ„ä¸ªç¨
                bonusMonthTotalIncome: bonusMonthTotalIncome, // å‘æ”¾æœˆè–ªèµ„æ€»é¢
                bonusMonthAfterTax: bonusMonthAfterTax // å‘æ”¾æœˆè–ªèµ„ç¨åæ”¶å…¥
            };
        }

        // è®¡ç®—å¹´ç»ˆå¥–å•ç‹¬è®¡ç¨ä¸ªç¨+ç¨åé‡‘é¢
        function calculateBonusTax(bonus) {
            if (bonus <= 0) return { tax: 0, afterTax: 0 };
            const monthlyBonus = bonus / 12;
            let tax = 0;
            for (let i = bonusTaxRates.length - 1; i >= 0; i--) {
                const b = bonusTaxRates[i];
                if (monthlyBonus > b.threshold) {
                    tax = bonus * b.rate - b.quickDeduction;
                    break;
                }
            }
            return {
                tax: tax,
                afterTax: bonus - tax // å¹´ç»ˆå¥–ç¨åé‡‘é¢
            };
        }

        // å¯»æ‰¾æœ€ä¼˜æ‹†åˆ†æ–¹æ¡ˆ
        function findOptimalSplit(salaryGross, yearBonus, specialDeduct, fundRatio, bonusMonth) {
            // 1. è®¡ç®—æ­å·äº”é™©ä¸€é‡‘æ‰£é™¤+æ‰£é™¤åè–ªèµ„
            const fiveInsResult = calculateFiveInsuranceFund(salaryGross, fundRatio);
            const salaryNet = fiveInsResult.salaryNet;
            const annualBaseSalary = salaryNet * 12;
            const totalIncome = annualBaseSalary + yearBonus; // å…¨å¹´ç»¼åˆæ”¶å…¥
            
            let minTotalTax = Infinity;
            // åˆå§‹åŒ–æœ€ä¼˜è§£å‚æ•°
            let opt = {
                mergeAmount: 0,
                bonusAmount: yearBonus,
                annualSalaryTax: 0,
                bonusTax: 0,
                bonusAfterTax: 0,
                bonusMonthTax: 0,
                bonusMonthTotalIncome: salaryNet,
                bonusMonthAfterTax: 0,
                febTotalAfterTax: 0 // å‘æ”¾æœˆåˆ°æ‰‹æ€»æ”¶å…¥
            };

            // ä¸ªç¨ä¸´ç•Œç‚¹ï¼ˆå¹´ç»ˆå¥–å•ç‹¬è®¡ç¨æ ¸å¿ƒèŠ‚ç‚¹ï¼‰
            const criticalPoints = [0, 36000, 144000, 300000, 420000, 660000, 960000, yearBonus];
            // æ„å»ºæ£€æŸ¥ç‚¹
            const checkPoints = new Set();
            criticalPoints.forEach(p => {
                if (p <= yearBonus) checkPoints.add(p);
                if (p - 1000 > 0 && p - 1000 <= yearBonus) checkPoints.add(p - 1000);
                if (p + 1000 <= yearBonus) checkPoints.add(p + 1000);
            });

            // éå†æ‰€æœ‰æ£€æŸ¥ç‚¹ï¼Œè®¡ç®—æœ€ä¼˜æ–¹æ¡ˆ
            checkPoints.forEach(bonusAmount => {
                const mergeAmount = yearBonus - bonusAmount;
                // è®¡ç®—è–ªèµ„ä¸ªç¨æ˜ç»†
                const salaryTaxDetail = calculateSalaryTaxDetail(salaryNet, specialDeduct, mergeAmount, bonusMonth);
                // è®¡ç®—å¹´ç»ˆå¥–ä¸ªç¨+ç¨å
                const bonusTaxDetail = calculateBonusTax(bonusAmount);
                // ä¸ªç¨æ€»é¢
                const totalTax = salaryTaxDetail.annualSalaryTax + bonusTaxDetail.tax;
                // å‘æ”¾æœˆåˆ°æ‰‹æ€»æ”¶å…¥ = å‘æ”¾æœˆè–ªèµ„ç¨å + å¹´ç»ˆå¥–ç¨å
                const febTotalAfterTax = salaryTaxDetail.bonusMonthAfterTax + bonusTaxDetail.afterTax;

                // æ›´æ–°æœ€ä¼˜è§£
                if (totalTax < minTotalTax) {
                    minTotalTax = totalTax;
                    opt = {
                        mergeAmount,
                        bonusAmount,
                        annualSalaryTax: salaryTaxDetail.annualSalaryTax,
                        bonusTax: bonusTaxDetail.tax,
                        bonusAfterTax: bonusTaxDetail.afterTax,
                        bonusMonthTax: salaryTaxDetail.bonusMonthTax,
                        bonusMonthTotalIncome: salaryTaxDetail.bonusMonthTotalIncome,
                        bonusMonthAfterTax: salaryTaxDetail.bonusMonthAfterTax,
                        febTotalAfterTax: febTotalAfterTax
                    };
                }
            });

            // è§„åˆ’å‰æ•°æ®ï¼ˆå¹´ç»ˆå¥–å…¨éƒ¨å•ç‹¬è®¡ç¨ï¼‰
            const beforeSalaryTaxDetail = calculateSalaryTaxDetail(salaryNet, specialDeduct, 0, bonusMonth);
            const beforeBonusTaxDetail = calculateBonusTax(yearBonus);
            const beforeTotalTax = beforeSalaryTaxDetail.annualSalaryTax + beforeBonusTaxDetail.tax;
            const beforeFebTotalAfterTax = beforeSalaryTaxDetail.bonusMonthAfterTax + beforeBonusTaxDetail.afterTax;
            const beforeAfterTax = totalIncome - beforeTotalTax; // è§„åˆ’å‰å…¨å¹´ç¨åæ”¶å…¥
            const afterAfterTax = totalIncome - minTotalTax; // è§„åˆ’åå…¨å¹´ç¨åæ”¶å…¥
            const saveTax = beforeTotalTax - minTotalTax; // èŠ‚ç¨é‡‘é¢

            return {
                salaryGross: salaryGross,
                fiveInsResult: fiveInsResult,
                totalIncome: totalIncome,
                bonusMonth: bonusMonth,
                // è§„åˆ’å‰æ•°æ®
                before: {
                    bonusAmount: yearBonus,
                    mergeAmount: 0,
                    bonusMonthTotalIncome: beforeSalaryTaxDetail.bonusMonthTotalIncome,
                    bonusMonthTax: beforeSalaryTaxDetail.bonusMonthTax,
                    bonusMonthAfterTax: beforeSalaryTaxDetail.bonusMonthAfterTax,
                    bonusTax: beforeBonusTaxDetail.tax,
                    bonusAfterTax: beforeBonusTaxDetail.afterTax,
                    febTotalAfterTax: beforeFebTotalAfterTax,
                    annualSalaryTax: beforeSalaryTaxDetail.annualSalaryTax,
                    totalTax: beforeTotalTax,
                    afterTaxIncome: beforeAfterTax
                },
                // è§„åˆ’åæ•°æ®
                after: opt,
                // èŠ‚ç¨/å·®å¼‚
                saveTax,
                afterTaxIncomeDiff: afterAfterTax - beforeAfterTax
            };
        }

        // é¡µé¢äº¤äº’é€»è¾‘
        document.getElementById('calculateBtn').addEventListener('click', function() {
            // è·å–è¾“å…¥å€¼
            const salaryGross = parseFloat(document.getElementById('monthlySalaryGross').value) || 0;
            const yearBonus = parseFloat(document.getElementById('yearBonus').value) || 0;
            const specialDeduct = parseFloat(document.getElementById('specialDeduction').value) || 0;
            const fundRatio = parseFloat(document.getElementById('housingFundRatio').value) || 12;
            const bonusMonth = parseInt(document.getElementById('bonusMonth').value) || 2;

            // è¾“å…¥æ ¡éªŒ
            if (salaryGross < 0 || yearBonus < 0 || specialDeduct < 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„éè´Ÿæ•°é‡‘é¢ï¼');
                return;
            }
            if (fundRatio < 5 || fundRatio > 12) {
                alert('å…¬ç§¯é‡‘æ¯”ä¾‹éœ€åœ¨5%-12%ä¹‹é—´ï¼');
                return;
            }
            if (salaryGross === 0 && yearBonus === 0) {
                alert('è¯·è¾“å…¥è–ªèµ„æˆ–å¹´ç»ˆå¥–é‡‘é¢ï¼');
                return;
            }

            // è®¡ç®—æœ€ä¼˜æ–¹æ¡ˆ
            const res = findOptimalSplit(salaryGross, yearBonus, specialDeduct, fundRatio, bonusMonth);

            // æ›´æ–°ç»“æœæ ‡é¢˜ï¼Œæ˜¾ç¤ºé€‰æ‹©çš„å‘æ”¾æœˆä»½
            document.getElementById('resultTitle').textContent = `è§„åˆ’å‰ VS è§„åˆ’å å…¨ç»´åº¦ç¨åŠ¡å¯¹æ¯”ï¼ˆå¹´ç»ˆå¥–${bonusMonth}æœˆå‘æ”¾ï¼‰`;

            // å¡«å……è§„åˆ’å‰åŸºç¡€æ•°æ®
            document.getElementById('before-salary-gross').textContent = formatNum(res.salaryGross);
            document.getElementById('before-five-insurance').textContent = formatNum(res.fiveInsResult.totalDeduct);
            document.getElementById('before-salary-net').textContent = formatNum(res.fiveInsResult.salaryNet);
            document.getElementById('before-total-income').textContent = formatNum(res.totalIncome);
            document.getElementById('before-bonus').textContent = formatNum(res.before.bonusAmount);
            document.getElementById('before-merge').textContent = formatNum(res.before.mergeAmount);
            document.getElementById('before-bonus-month-income').textContent = formatNum(res.before.bonusMonthTotalIncome);
            document.getElementById('before-bonus-month-tax').textContent = formatNum(res.before.bonusMonthTax);
            document.getElementById('before-bonus-month-after-tax').textContent = formatNum(res.before.bonusMonthAfterTax);
            document.getElementById('before-bonus-tax').textContent = formatNum(res.before.bonusTax);
            document.getElementById('before-bonus-after-tax').textContent = formatNum(res.before.bonusAfterTax);
            document.getElementById('before-feb-total-after-tax').textContent = formatNum(res.before.febTotalAfterTax);
            document.getElementById('before-salary-tax').textContent = formatNum(res.before.annualSalaryTax);
            document.getElementById('before-total-tax').textContent = formatNum(res.before.totalTax);
            document.getElementById('before-after-tax-income').textContent = formatNum(res.before.afterTaxIncome);

            // å¡«å……è§„åˆ’ååŸºç¡€æ•°æ®
            document.getElementById('after-salary-gross').textContent = formatNum(res.salaryGross);
            document.getElementById('after-five-insurance').textContent = formatNum(res.fiveInsResult.totalDeduct);
            document.getElementById('after-salary-net').textContent = formatNum(res.fiveInsResult.salaryNet);
            document.getElementById('after-total-income').textContent = formatNum(res.totalIncome);
            document.getElementById('after-bonus').textContent = formatNum(res.after.bonusAmount);
            document.getElementById('after-merge').textContent = formatNum(res.after.mergeAmount);
            document.getElementById('after-bonus-month-income').textContent = formatNum(res.after.bonusMonthTotalIncome);
            document.getElementById('after-bonus-month-tax').textContent = formatNum(res.after.bonusMonthTax);
            document.getElementById('after-bonus-month-after-tax').textContent = formatNum(res.after.bonusMonthAfterTax);
            document.getElementById('after-bonus-tax').textContent = formatNum(res.after.bonusTax);
            document.getElementById('after-bonus-after-tax').textContent = formatNum(res.after.bonusAfterTax);
            document.getElementById('after-feb-total-after-tax').textContent = formatNum(res.after.febTotalAfterTax);
            document.getElementById('after-salary-tax').textContent = formatNum(res.after.annualSalaryTax);
            document.getElementById('after-total-tax').textContent = formatNum(res.before.totalTax - res.saveTax);
            document.getElementById('after-after-tax-income').textContent = formatNum(res.before.afterTaxIncome + res.saveTax);

            // å¡«å……å·®å¼‚æ•°æ®ï¼ˆå¸¦æ ·å¼ï¼‰
            document.getElementById('diff-bonus').innerHTML = formatDiff(res.after.bonusAmount - res.before.bonusAmount);
            document.getElementById('diff-merge').innerHTML = formatDiff(res.after.mergeAmount - res.before.mergeAmount);
            document.getElementById('diff-bonus-month-income').innerHTML = formatDiff(res.after.bonusMonthTotalIncome - res.before.bonusMonthTotalIncome);
            document.getElementById('diff-bonus-month-tax').innerHTML = formatDiff(res.after.bonusMonthTax - res.before.bonusMonthTax);
            document.getElementById('diff-bonus-month-after-tax').innerHTML = formatDiff(res.after.bonusMonthAfterTax - res.before.bonusMonthAfterTax);
            document.getElementById('diff-bonus-tax').innerHTML = formatDiff(res.after.bonusTax - res.before.bonusTax);
            document.getElementById('diff-bonus-after-tax').innerHTML = formatDiff(res.after.bonusAfterTax - res.before.bonusAfterTax);
            document.getElementById('diff-feb-total-after-tax').innerHTML = formatDiff(res.after.febTotalAfterTax - res.before.febTotalAfterTax);
            document.getElementById('diff-salary-tax').innerHTML = formatDiff(res.after.annualSalaryTax - res.before.annualSalaryTax);
            document.getElementById('save-tax').innerHTML = formatDiff(-res.saveTax);
            document.getElementById('diff-after-tax-income').innerHTML = formatDiff(res.afterTaxIncomeDiff);

            // æ˜¾ç¤ºç»“æœå¹¶å¹³æ»‘æ»šåŠ¨
            document.getElementById('result').style.display = 'block';
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        });

        // è¾“å…¥æ¡†å±è”½éæ•°å­—å­—ç¬¦
        const numberInputs = document.querySelectorAll('input[type="number"]');
        numberInputs.forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (['e', 'E', '+', '-'].includes(e.key)) e.preventDefault();
            });
        });
    </script>
</body>
</html>
